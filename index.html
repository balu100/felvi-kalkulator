<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>√âretts√©gi pontsz√°m√≠t√≥ 2025 ‚Ä¢ friss√≠tve: 2025-09-11</title>
<style>
  :root{
    --bg: #fff; --fg:#111; --muted:#666; --line:#e5e5e5; --accent:#111;
    --ok:#0a0; --warn:#a60; --err:#a00; --soft:#f8f8f8;
  }
  .dark{
    --bg:#111; --fg:#eee; --muted:#aaa; --line:#2a2a2a; --accent:#fff;
    --ok:#65d665; --warn:#e0a85c; --err:#ff6b6b; --soft:#1a1a1a;
  }
  html,body{height:100%}
  body{ margin:0; font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--fg); background:var(--bg); }
  header{position:sticky; top:0; z-index:3; background:var(--bg); border-bottom:1px solid var(--line)}
  .wrap{max-width:1100px; margin-inline:auto; padding:10px 16px}
  h1{font-size:20px; margin:8px 0}
  .sub{color:var(--muted); font-size:13px}
  .grid{display:grid; gap:14px}
  @media(min-width:900px){ .grid.cols-2{grid-template-columns:1fr 1fr} }
  fieldset{border:1px solid var(--line); border-radius:12px; padding:12px}
  legend{padding:0 6px; color:var(--muted); font-size:12px}
  label{display:block; font-size:13px; margin-bottom:4px}
  select, input[disabled], input[type="url"], input[type="number"]{ width:100%; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:var(--bg); color:var(--fg) }
  .row{display:grid; grid-template-columns:1.5fr .8fr .8fr; gap:10px; align-items:end}
  .row.compact{grid-template-columns:1fr 1fr 1fr 1fr}
  .row > div{min-width:0}
  .section-title{font-weight:600; margin:6px 0 2px}
  .pill{display:inline-block; padding:6px 10px; border:1px solid var(--line); border-radius:999px; cursor:pointer; user-select:none}
  .pill input{accent-color:var(--accent)}
  .pills{display:flex; gap:8px; flex-wrap:wrap}
  .muted{color:var(--muted)}
  .help{font-size:12px; color:var(--muted)}
  .warn{color:var(--warn)} .err{color:var(--err)} .ok{color:var(--ok)}
  .divider{height:1px; background:var(--line); margin:8px 0}
  .controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  button{border:1px solid var(--line); background:var(--bg); color:var(--fg); padding:8px 12px; border-radius:10px; cursor:pointer}
  button.primary{background:var(--fg); color:var(--bg)}
  .footer{position:sticky; bottom:0; z-index:3; border-top:1px solid var(--line); background:color-mix(in oklab, var(--bg) 97%, transparent); backdrop-filter:saturate(140%) blur(6px)}
  .totals{display:grid; gap:8px; align-items:center}
  @media(min-width:900px){ .totals{grid-template-columns: 1fr auto} }
  .sumline{display:flex; gap:10px; flex-wrap:wrap; align-items:baseline}
  .sumline b{font-size:20px}
  .badge{border:1px solid var(--line); padding:2px 8px; border-radius:999px; font-size:12px}
  .kpi{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .kpi span{font-size:12px; color:var(--fg)}
  .kpi b{font-size:18px}
  .errorbox{border:1px solid color-mix(in oklab, var(--err) 30%, var(--bg)); background:color-mix(in oklab, var(--err) 6%, var(--bg)); color:var(--err); padding:8px 10px; border-radius:8px}
  .okbox{border:1px solid color-mix(in oklab, var(--ok) 30%, var(--bg)); background:color-mix(in oklab, var(--ok) 6%, var(--bg)); color:color-mix(in oklab, var(--ok) 70%, black); padding:8px 10px; border-radius:8px}
  .sticky-note{font-size:12px; color:var(--muted)}
  .ghost{opacity:.6}
  .soft{background:var(--soft)}
  .hdr-actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--line); border-radius:999px}
</style>
</head>
<body>
  <header>
    <div class="wrap hdr-actions">
      <div style="flex:1">
        <h1>√âretts√©gi pontsz√°m√≠t√≥ <span class="muted">2025</span></h1>
        <div class="sub">Felvi 2025 szab√°lyok. Mobilbar√°t. Link-megoszt√°s √©s helyi ment√©s.</div>
      </div>
      <button id="themeBtn" aria-label="T√©ma v√°lt√°sa">üåô/‚òÄ</button>
    </div>
  </header>

  <main class="wrap grid" style="margin-bottom:90px">

    <section>
      <div class="section-title">M√≥d</div>
      <div class="pills" id="modePills">
        <label class="pill"><input type="radio" name="mode" value="standard" checked> Standard (tanulm√°nyi + √©retts√©gi / √©retts√©gi√ó2)</label>
        <label class="pill"><input type="radio" name="mode" value="practice"> Gyakorlati vizsg√°s szak</label>
        <label class="pill"><input type="radio" name="mode" value="sport500"> Nemzetk√∂zi √©lsport (500 pont)</label>
      </div>
      <div class="help">‚Ä¢ Gyakorlati szakokon a v√©g√∂sszeg: gyakorlati pont√ó2, int√©zm√©nyi pont <b>nem</b> adhat√≥, csak katonai t√∂bbletpont lehets√©ges. ‚Ä¢ Sport 500: 500 pont, ha a bemeneti felt√©telek megvannak (min. k√©t √©retts√©gi eredm√©ny stb.).</div>
      <div class="divider"></div>
    </section>

    <section id="standardPanel" class="grid cols-2">
      <fieldset>
        <legend>Tanulm√°nyi pontok (max 200) <span title="A Hivatal csak akkor sz√°molja, ha az E‚Äëfelv√©teliben jel√∂lted √©s felt√∂lt√∂tted a bizony√≠tv√°nyoldalakat.">‚Ñπ</span></legend>
        <div class="section-title">1) K√∂z√©piskolai √©v v√©gi jegyek ‚Äì 0‚Ä¶100 pont</div>
        <div class="help">A k√©t utols√≥ tanult √©v jegyei t√°rgyank√©nt √∂sszeadva, majd √ó2. Magyar nyelv √©s irodalomn√°l a k√©t jegy sz√°mtani √°tlaga √©vk√©nt.</div>
        <div id="grades"></div>
        <div class="divider"></div>
        <div class="section-title">2) √âretts√©gi √°tlag (max 100)</div>
        <div class="help">A 4 k√∂telez≈ë + 1 int√©zm√©nyi t√°rgy k√∂z√ºl 5 legjobb sz√°zal√©k √°tlag√°nak eg√©szre kerek√≠t√©se. Ha <i>kevesebb mint 5</i> √°ll rendelkez√©sre, annyib√≥l sz√°molunk.</div>
        <div id="eriAvg"></div>
        <div class="sticky-note" style="margin-top:6px">Megnevez√©sek: ‚ÄûInformatika (Digit√°lis kult√∫ra)‚Äù 2020/2024 ut√°n a kor√°bbi ‚ÄûInformatika‚Äù helyett terjedt el.</div>
      </fieldset>

      <fieldset>
        <legend>√âretts√©gi pontok (max 200)</legend>
        <div class="help">K√©t vizsgat√°rgy. Emelt: pont = %. K√∂z√©p: pont = t√°bl√°zat szerinti √°tsz√°m√≠t√°s.</div>
        <div id="eriPoints"></div>
        <div class="divider"></div>
        <label class="pill" style="margin-top:6px"><input type="checkbox" id="useVET"> Technikumi/szakmai vizsga haszn√°lata az egyik t√°rgy helyett</label>
        <div id="vetRow" style="display:none; margin-top:8px">
          <div class="row">
            <div>
              <label>VET t√≠pus</label>
              <select id="vetType">
                <option value="emelt">Technikumi oklev√©l (emelt)</option>
                <option value="kozep">Szakk√©pes√≠t≈ë / OKJ-ut√≥d (k√∂z√©p)</option>
              </select>
            </div>
            <div>
              <label>Vizsgaeredm√©ny (%)</label>
              <select id="vetPct"></select>
            </div>
            <div>
              <label>Pont (VET + m√°sik t√°rgy)</label>
              <input id="vetPts" disabled value="‚Äì" class="soft"/>
            </div>
          </div>
          <div class="help">‚Ñπ A VET <b>nem</b> v√°ltja ki a k√∂telez≈ë emelt szint≈± √©retts√©git, ha a szak ilyen felt√©telt √≠r el≈ë (csak t√°rgyat helyettes√≠t).</div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Szak‚Äëszab√°lyok ellen≈ërz√©se (opcion√°lis)</legend>
        <div class="chips" id="progSubjects"></div>
        <div class="row compact" style="margin-top:8px">
          <div>
            <label>Min. emelt szint≈± √©retts√©gi az elfogadott t√°rgyakb√≥l</label>
            <select id="minEmelt">
              <option value="0">0</option>
              <option value="1" selected>1</option>
              <option value="2">2</option>
            </select>
          </div>
          <div>
            <label>Meghirdet√©s linkje (Felvi)</label>
            <input id="progLink" type="url" placeholder="https://www.felvi.hu/...">
          </div>
          <div>
            <label>Link m≈±veletek</label>
            <div class="controls">
              <button id="openProg" type="button">Megnyit√°s</button>
            </div>
          </div>
        </div>
        <div class="help">V√°laszd ki az elfogadott t√°rgyakat. A kalkul√°tor jelez, ha a kiv√°lasztott 2 √©retts√©gi t√°rgy nem felel meg, vagy nincs meg a min. emelt.</div>
      </fieldset>

      <fieldset>
        <legend>Int√©zm√©nyi √©s katonai pontok</legend>
        <div class="row compact">
          <div>
            <label>Int√©zm√©nyi pontok (max 100)</label>
            <select id="instPts"></select>
          </div>
          <div>
            <label>√ñnk√©ntes katonai pont</label>
            <select id="milPts">
              <option value="0">0</option>
              <option value="16">16</option>
              <option value="32">32</option>
              <option value="64">64</option>
            </select>
          </div>
          <div>
            <label>Megoszthat√≥ link</label>
            <button id="shareBtn">Link m√°sol√°sa</button>
          </div>
          <div>
            <label>Adatok</label>
            <div class="controls">
              <button id="resetBtn">Vissza√°ll√≠t√°s</button>
              <button id="saveBtn" class="primary">Ment√©s</button>
            </div>
          </div>
        </div>
        <div class="help">Az int√©zm√©nyi pontokat a fels≈ëoktat√°si int√©zm√©ny szabja meg szakonk√©nt.</div>
      </fieldset>
    </section>

    <section id="practicePanel" style="display:none">
      <fieldset>
        <legend>Gyakorlati vizsg√°s szakok</legend>
        <div class="row compact">
          <div>
            <label>Gyakorlati maximum</label>
            <select id="practiceMax">
              <option value="200" selected>200</option>
              <option value="100">100</option>
            </select>
          </div>
          <div>
            <label>Gyakorlati pont (0‚Äìmax)</label>
            <select id="practiceScore"></select>
          </div>
          <div>
            <label>√ñnk√©ntes katonai pont</label>
            <select id="milPtsPractice">
              <option value="0">0</option>
              <option value="16">16</option>
              <option value="32">32</option>
              <option value="64">64</option>
            </select>
          </div>
          <div>
            <label>Megoszthat√≥ link</label>
            <button id="shareBtn2">Link m√°sol√°sa</button>
          </div>
        </div>
        <div class="okbox" style="margin-top:8px">√ñsszpontsz√°m = gyakorlati pont √ó 2. Int√©zm√©nyi pont nem adhat√≥. Csak az √∂nk√©ntes katonai t√∂bbletpont sz√°m√≠that√≥.</div>
      </fieldset>
    </section>

    <section id="sportPanel" style="display:none">
      <fieldset>
        <legend>Nemzetk√∂zi √©lsport eredm√©ny</legend>
        <div class="okbox">Jogosults√°g eset√©n a felv√©teli √∂sszpontsz√°m: <b>500 pont</b>. Emellett teljes√≠teni kell a szak k√∂telez≈ë felt√©teleit (min. k√©t √©retts√©gi eredm√©ny az el≈ë√≠rt szinten, esetleges alkalmass√°gi, stb.).</div>
        <div class="controls" style="margin-top:8px">
          <button id="shareBtn3">Link m√°sol√°sa</button>
        </div>
      </fieldset>
    </section>

    <section>
      <fieldset>
        <legend>Dokumentumok √©s hat√°rid≈ëk</legend>
        <ul class="help" style="margin:0 0 6px 16px; padding:0">
          <li>Bizony√≠tv√°nyoldalak felt√∂lt√©se az E‚Äëfelv√©teliben a tanulm√°nyi pontokhoz.</li>
          <li>Nyelvvizsga, VET/technikumi oklev√©l, egy√©b igazol√°sok felt√∂lt√©se.</li>
          <li>Hat√°rid≈ëk: a Felvi meghirdet√©s oldalain √©s a k√∂zponti t√°j√©koztat√≥ban.</li>
        </ul>
        <div class="sticky-note">Hasznos: felvi.hu ‚Ä¢ oktatas.hu ‚Ä¢ eduline.hu</div>
      </fieldset>
    </section>

  </main>

  <footer class="footer">
    <div class="wrap totals">
      <div class="sumline">
        <span class="badge">Alap 0‚Äì400</span>
        <span>Tanulm√°nyi: <b id="sumStudy">0</b></span>
        <span>√âretts√©gi: <b id="sumExam">0</b></span>
        <span class="muted">k√©plet: <b id="formula">‚Äì</b></span>
        <span>| Int√©zm√©nyi: <b id="sumInst">0</b></span>
        <span>| Katonai: <b id="sumMil">0</b></span>
        <span class="badge ghost" id="maxBadge">Max: 564 (400+100+64)</span>
      </div>
      <div class="kpi"><span>V√©g√∂sszeg:</span><b id="grandTotal">0</b></div>
    </div>
  </footer>

<script>
(function(){
  // --- Utilities ---
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const toInt = v => parseInt(v,10) || 0;
  const clamp = (n,min,max)=> Math.min(max, Math.max(min, n));

  // Theme
  const themeBtn = $('#themeBtn');
  function setTheme(mode){ document.body.classList.toggle('dark', mode==='dark'); localStorage.setItem('erettsegi_calc_theme', mode); }
  themeBtn?.addEventListener('click', ()=>{ const now = document.body.classList.contains('dark')?'light':'dark'; setTheme(now); });
  setTheme(localStorage.getItem('erettsegi_calc_theme') || (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'));

  // Percent options helper with blank first
  function fillPercentSelect(sel, start=0, withBlank=false){ sel.innerHTML = ''; if(withBlank){ const z=document.createElement('option'); z.value=''; z.textContent='‚Äî'; sel.appendChild(z); } for(let i=start;i<=100;i++){ const o=document.createElement('option'); o.value=o.textContent=i; sel.appendChild(o); } }
  function fillRangeSelect(sel, start, end){ sel.innerHTML=''; for(let i=start;i<=end;i++){ const o=document.createElement('option'); o.value=o.textContent=i; sel.appendChild(o); } }

  // Map of k√∂z√©pszint % -> felv√©teli pont (Felvi t√°bl√°zat 2025)
  const midMap = new Map([
    [20,13],[21,14],[22,15],[23,15],[24,16],[25,17],[26,17],[27,18],[28,19],[29,19],[30,20],[31,21],[32,21],[33,22],[34,23],[35,23],[36,24],[37,25],[38,25],[39,26],[40,27],[41,27],[42,28],[43,29],[44,29],[45,30],[46,31],[47,31],[48,32],[49,33],[50,33],[51,34],[52,35],[53,35],[54,36],[55,37],[56,37],[57,38],[58,39],[59,39],[60,40],[61,41],[62,41],[63,42],[64,43],[65,43],[66,44],[67,45],[68,45],[69,46],[70,47],[71,47],[72,48],[73,49],[74,49],[75,50],[76,51],[77,51],[78,52],[79,53],[80,53],[81,54],[82,55],[83,55],[84,56],[85,57],[86,57],[87,58],[88,59],[89,59],[90,60],[91,61],[92,61],[93,62],[94,63],[95,63],[96,64],[97,65],[98,65],[99,66],[100,67]
  ]);
  const midPoint = pct => midMap.get(clamp(pct,20,100)) ?? 0;

  // Subjects
  const subjectsAll = [
    'Magyar nyelv √©s irodalom','Matematika','T√∂rt√©nelem','Angol nyelv','N√©met nyelv','Francia nyelv','Olasz nyelv','Spanyol nyelv','Orosz nyelv','Biol√≥gia','Fizika','K√©mia','F√∂ldrajz','Informatika (Digit√°lis kult√∫ra)','Informatika','√ânek-zene','Rajz √©s vizu√°lis kult√∫ra','Gazdas√°gi ismeretek','√Ållampolg√°ri ismeretek','M≈±v√©szett√∂rt√©net'
  ];

  // --- Build UI dynamic parts ---
  // Grades block: 5 subjects x 2 years dropdown
  const gradesHost = $('#grades');
  const gradeSubjects = [
    { key:'magyar', label:'Magyar nyelv √©s irodalom' },
    { key:'tori', label:'T√∂rt√©nelem' },
    { key:'matek', label:'Matematika' },
    { key:'nyelv', label:'Idegen nyelv (lent v√°laszthat√≥)' },
    { key:'valasztott', label:'V√°lasztott (int√©zm√©ny √°ltal elfogadott)' }
  ];
  gradesHost.innerHTML = gradeSubjects.map(s=>`
    <div class="row compact" data-key="${s.key}">
      <div><label>${s.label} ‚Äì utols√≥ el≈ëtti √©v</label><select class="gradeA"></select></div>
      <div><label>${s.label} ‚Äì utols√≥ √©v</label><select class="gradeB"></select></div>
      <div><label>Jegyek √∂sszege√ó2</label><input disabled value="‚Äì" class="gSum soft"></div>
      <div>${s.key==='nyelv' ? `<label>V√°lasztott nyelv</label><select class="langPick"></select>` : `<label> </label><div class="muted" style="padding:9px 0"></div>`}</div>
    </div>
  `).join('');
  // Fill grade selects 1..5
  $$('#grades select.gradeA, #grades select.gradeB').forEach(sel=>fillRangeSelect(sel,1,5));
  // Fill language picker
  $$('#grades .langPick').forEach(sel=>{ ['Angol nyelv','N√©met nyelv','Francia nyelv','Olasz nyelv','Spanyol nyelv','Orosz nyelv'].forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v; sel.appendChild(o);}); });

  // √âretts√©gi √°tlag block (0‚Äì5 input)
  const eriAvgHost = $('#eriAvg');
  const eriAvgRows = [
    {key:'magyarP', label:'Magyar nyelv √©s irodalom %'},
    {key:'toriP', label:'T√∂rt√©nelem %'},
    {key:'matekP', label:'Matematika %'},
    {key:'nyelvP', label:'Idegen nyelv %'},
    {key:'valasztottP', label:'V√°lasztott t√°rgy %'},
  ];
  eriAvgHost.innerHTML = eriAvgRows.map(r=>`
    <div class="row compact" data-key="${r.key}">
      <div><label>${r.label}</label><select class="pct-avg"></select></div>
      <div><label> </label><div class="muted" style="padding:9px 0">‚Äî vagy 0‚Äì100%</div></div>
      <div><label> </label><div class="muted" style="padding:9px 0"></div></div>
      <div><label> </label><div class="muted" style="padding:9px 0"></div></div>
    </div>
  `).join('');
  $$('#eriAvg select.pct-avg').forEach(sel=>fillPercentSelect(sel,0,true));

  // √âretts√©gi pontok (2 t√°rgy)
  const eriHost = $('#eriPoints');
  const examRows = [0,1].map(i=>`
    <div class="row exam-row" data-exam="${i}">
      <div><label>Vizsgat√°rgy</label><select class="subj"></select></div>
      <div><label>Szint</label><select class="lvl"><option value="emelt">Emelt</option><option value="kozep">K√∂z√©p</option></select></div>
      <div><label>Eredm√©ny (%)</label><select class="pct"></select></div>
    </div>
  `).join('');
  eriHost.innerHTML = examRows;
  $$('#eriPoints .pct').forEach(sel=>fillPercentSelect(sel,20));
  $$('#eriPoints .subj').forEach(sel=>{ subjectsAll.forEach(v=>{const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o);}); });

  // VET select
  fillPercentSelect($('#vetPct'), 20);

  // Int√©zm√©nyi pontok select
  fillRangeSelect($('#instPts'),0,100);

  // Practice select
  function fillPracticeScore(){ const max = toInt($('#practiceMax').value)||200; fillRangeSelect($('#practiceScore'),0,max); }
  fillPracticeScore();

  // Program rules chips
  const progHost = $('#progSubjects');
  progHost.innerHTML = subjectsAll.map(s=>{
    const id = 'sub_'+s.replace(/[^a-z0-9]+/gi,'_');
    return `<label class="chip"><input type="checkbox" class="progSub" id="${id}" value="${s}"> <span>${s}</span></label>`;
  }).join('');

  // Mode switching
  const modeRadios = $$('input[name="mode"]');
  function refreshMode(){
    const mode = modeRadios.find(r=>r.checked)?.value || 'standard';
    $('#standardPanel').style.display = mode==='standard'? '' : 'none';
    $('#practicePanel').style.display = mode==='practice'? '' : 'none';
    $('#sportPanel').style.display = mode==='sport500'? '' : 'none';
    $('#maxBadge').textContent = mode==='sport500' ? 'Max: 500 (sport fix)' : 'Max: 564 (400+100+64)';
    calc();
  }
  modeRadios.forEach(r=>r.addEventListener('change', refreshMode));

  // Toggle VET row
  $('#useVET').addEventListener('change', e=>{ $('#vetRow').style.display = e.target.checked? '' : 'none'; calc(); });
  $('#vetPct').addEventListener('change', calc);
  $('#vetType').addEventListener('change', calc);

  // Practice events
  $('#practiceMax').addEventListener('change', ()=>{ fillPracticeScore(); calc(); });
  $('#practiceScore').addEventListener('change', calc);

  // Listeners
  document.addEventListener('change', (e)=>{
    if(e.target.closest('#grades') || e.target.closest('#eriAvg') || e.target.closest('#eriPoints') || e.target.closest('#practicePanel') || e.target.id==='instPts' || e.target.id==='milPts' || e.target.id==='milPtsPractice' || e.target.classList.contains('progSub') || e.target.id==='minEmelt'){
      calc();
    }
  });
  $('#openProg').addEventListener('click', ()=>{ const u=$('#progLink').value; if(u) window.open(u,'_blank'); });

  // Helpers
  function gradesPart(){
    // sum of (two last-year grades per subject) * 2, across 5 subjects, capped 100
    let sum=0;
    $$('#grades .row.compact').forEach(row=>{
      const a = toInt(row.querySelector('.gradeA').value);
      const b = toInt(row.querySelector('.gradeB').value);
      const s = (a+b)*2;
      row.querySelector('.gSum').value = String(s||0);
      sum += s;
    });
    return clamp(sum,0,100);
  }

  function eriAvgPart(){
    // average of up to five % rounded to integer; blank entries ignored
    const vals = $$('#eriAvg .pct-avg').map(s=>s.value).filter(v=>v!=='').map(v=>toInt(v));
    if(vals.length===0) return 0;
    const avg = vals.reduce((a,b)=>a+b,0)/vals.length;
    return Math.round(avg);
  }

  function examPoints(){
    const rows = $$('#eriPoints .exam-row');
    let valid = true; let parts=[];
    rows.forEach(r=>{
      const subj = r.querySelector('.subj').value;
      const lvl = r.querySelector('.lvl').value;
      const pct = toInt(r.querySelector('.pct').value);
      if(!pct || pct<20) valid=false;
      const pts = (lvl==='emelt') ? pct : midPoint(pct);
      parts.push({subj,lvl,pct,pts});
    });

    if($('#useVET').checked){
      const vetPct = toInt($('#vetPct').value);
      const vetType = $('#vetType').value; // emelt|kozep
      if(!vetPct || vetPct<20) valid=false;
      const vetPts = vetType==='emelt' ? vetPct : midPoint(vetPct);
      // Use the better of the two exam subjects alongside VET
      parts.sort((a,b)=>b.pts-a.pts);
      const other = parts[0]?.pts || 0;
      const total = clamp(vetPts + other, 0, 200);
      $('#vetPts').value = String(total || '0');
      return { total, valid, parts, vet:{pct:vetPct,type:vetType,pts:vetPts} };
    } else {
      const total = clamp(parts.reduce((a,b)=>a+b.pts,0), 0, 200);
      return { total, valid, parts };
    }
  }

  function computeStandard(){
    const g = gradesPart();
    const a = eriAvgPart();
    const study = clamp(g + a, 0, 200);
    const {total: exam, valid, parts, vet} = examPoints();
    // Two formulas: study+exam vs exam*2, pick max
    const f1 = study + exam;
    const f2 = exam * 2;
    const base = Math.max(f1, f2);
    const formula = base===f2 ? '√âretts√©gi√ó2' : 'Tanulm√°nyi+√âretts√©gi';
    return { study, exam, base, formula, valid, parts, vet };
  }

  function computePractice(){
    const score = toInt($('#practiceScore').value);
    const base = clamp(score*2, 0, 400);
    return { base };
  }

  function getProgRules(){
    const accepted = $$('.progSub:checked').map(cb=>cb.value);
    const minEmelt = toInt($('#minEmelt').value||'0');
    const link = $('#progLink').value||'';
    return {accepted, minEmelt, link};
  }

  function calc(){
    const mode = $$('input[name="mode"]').find(r=>r.checked)?.value || 'standard';
    let base=0, study=0, exam=0, formula='‚Äì', valid=true, parts=[], vet=null;

    if(mode==='standard'){
      const res = computeStandard();
      ({study, exam, base, formula, valid, parts, vet} = res);
      $('#sumInst').textContent = $('#instPts').value;
      $('#sumMil').textContent = $('#milPts').value;
    }
    else if(mode==='practice'){
      const res = computePractice();
      base = res.base;
      study=0; exam=0; formula='Gyakorlati√ó2';
      $('#sumInst').textContent = '0'; // tiltott
      $('#sumMil').textContent = $('#milPtsPractice').value;
    }
    else { // sport500
      base = 500; study=0; exam=0; formula='Sport 500';
      $('#sumInst').textContent = '0';
      $('#sumMil').textContent = '0';
    }

    $('#sumStudy').textContent = study;
    $('#sumExam').textContent = exam;
    $('#formula').textContent = formula;

    let total = base;
    if(mode==='standard') total += toInt($('#instPts').value) + toInt($('#milPts').value);
    if(mode==='practice') total += toInt($('#milPtsPractice').value); // csak ez engedett
    if(mode==='sport500') total = 500;

    $('#grandTotal').textContent = String(total);

    validate(mode, valid, parts, vet);
    saveState();
    syncURL();
  }

  function validate(mode, examValid, parts, vet){
    const issues = [];

    if(mode==='standard'){
      if(!examValid) issues.push('Adj meg k√©t √©retts√©gi t√°rgyat legal√°bb 20%-os eredm√©nnyel.');
      // duplicate subject warning
      if(parts && parts.length===2 && parts[0].subj === parts[1].subj){ issues.push('A k√©t √©retts√©gi t√°rgy ne legyen azonos.'); }
      // avg filled? at least 1 provided
      const filledAny = $$('#eriAvg .pct-avg').some(s=>s.value!=='');
      if(!filledAny) issues.push('Az √©retts√©gi √°tlaghoz adj meg legal√°bb 1 t√°rgyat.');
      // 25% successful exam threshold
      const under25 = parts.filter(p=>p.pct>0 && p.pct<25).map(p=>p.subj);
      if(under25.length){ issues.push('25% alatt az √©retts√©gi nem sikeres: '+under25.join(', ')+'.'); }
      if($('#useVET').checked && vet && vet.pct>0 && vet.pct<25){ issues.push('VET eredm√©ny 25% alatt nem tekinthet≈ë sikeresnek.'); }

      // program rules
      const rules = getProgRules();
      if(rules.accepted.length){
        // subject acceptance
        const notAccepted = parts.filter(p=>!rules.accepted.includes(p.subj)).map(p=>p.subj);
        if(notAccepted.length){ issues.push('A szak nem fogadja el: '+notAccepted.join(', ')+'.'); }
        // min emelt
        const emelts = parts.filter(p=>rules.accepted.includes(p.subj) && p.lvl==='emelt').length;
        if(emelts < rules.minEmelt){ issues.push('Nincs meg a minim√°lisan elv√°rt emelt szint ('+rules.minEmelt+').'); }
      }
    }

    if(mode==='practice'){
      const max = toInt($('#practiceMax').value)||200;
      const val = toInt($('#practiceScore').value)||0;
      if(val>max) issues.push('A gyakorlati pont nem lehet nagyobb, mint a kiv√°lasztott maximum.');
    }

    let box = document.getElementById('valBox');
    if(!box){ box = document.createElement('div'); box.id='valBox'; box.style.marginTop='8px'; $('#standardPanel').appendChild(box); }
    if(issues.length){ box.className='errorbox'; box.textContent = issues.join(' ‚Ä¢ '); }
    else { box.className='okbox'; box.textContent = 'Bemenetek rendben.'; }
  }

  // Share link + localStorage
  function currentState(){
    const mode = $$('input[name="mode"]').find(r=>r.checked)?.value || 'standard';
    const state = { v:3, mode }; // v=state schema
    if(mode==='standard'){
      state.grades = $$('#grades .row.compact').map(r=>({ a:r.querySelector('.gradeA').value, b:r.querySelector('.gradeB').value, lang:r.querySelector('.langPick')?.value||'' }));
      state.eriAvg = $$('#eriAvg .pct-avg').map(s=>s.value);
      state.exams = $$('#eriPoints .row').map(r=>({ subj:r.querySelector('.subj').value, lvl:r.querySelector('.lvl').value, pct:r.querySelector('.pct').value }));
      state.useVET = $('#useVET').checked; state.vetPct = $('#vetPct').value; state.vetType = $('#vetType').value;
      state.instPts = $('#instPts').value; state.milPts = $('#milPts').value;
      // program rules
      const rules = getProgRules();
      state.prog = { accepted: rules.accepted, minEmelt: rules.minEmelt, link: rules.link };
    } else if(mode==='practice'){
      state.practiceScore = $('#practiceScore').value; state.milPtsP = $('#milPtsPractice').value; state.practiceMax = $('#practiceMax').value;
    }
    state.theme = document.body.classList.contains('dark')?'dark':'light';
    return state;
  }
  function applyState(state){
    if(!state) return;
    if(state.theme) setTheme(state.theme);
    if(state.mode){ const r = $$('input[name="mode"]').find(x=>x.value===state.mode); if(r){ r.checked=true; } }
    refreshMode();
    if(state.mode==='standard' && state.grades){
      $$('#grades .row.compact').forEach((r,i)=>{ const g=state.grades[i]||{}; if(g.a) r.querySelector('.gradeA').value=g.a; if(g.b) r.querySelector('.gradeB').value=g.b; if(g.lang) r.querySelector('.langPick').value=g.lang;});
      if(state.eriAvg) $$('#eriAvg .pct-avg').forEach((s,i)=>{ if(state.eriAvg[i]!=null) s.value=state.eriAvg[i]; });
      if(state.exams) $$('#eriPoints .row').forEach((r,i)=>{ const e=state.exams[i]||{}; if(e.subj) r.querySelector('.subj').value=e.subj; if(e.lvl) r.querySelector('.lvl').value=e.lvl; if(e.pct) r.querySelector('.pct').value=e.pct; });
      if(state.useVET){ $('#useVET').checked=true; $('#vetRow').style.display=''; } else { $('#useVET').checked=false; $('#vetRow').style.display='none'; }
      if(state.vetPct) $('#vetPct').value=state.vetPct; if(state.vetType) $('#vetType').value=state.vetType;
      if(state.instPts) $('#instPts').value=state.instPts; if(state.milPts) $('#milPts').value=state.milPts;
      if(state.prog){
        if(state.prog.accepted){ state.prog.accepted.forEach(name=>{ const cb = $$('.progSub').find(x=>x.value===name); if(cb) cb.checked=true; }); }
        if(state.prog.minEmelt!=null){ $('#minEmelt').value=String(state.prog.minEmelt); }
        if(state.prog.link){ $('#progLink').value=state.prog.link; }
      }
    }
    if(state.mode==='practice'){
      if(state.practiceMax) $('#practiceMax').value=state.practiceMax; fillPracticeScore();
      if(state.practiceScore) $('#practiceScore').value=state.practiceScore; if(state.milPtsP) $('#milPtsPractice').value=state.milPtsP;
    }
  }
  function syncURL(){
    const s = currentState();
    const q = new URLSearchParams({ s: btoa(unescape(encodeURIComponent(JSON.stringify(s)))) });
    history.replaceState(null,'', location.pathname + '?' + q.toString());
  }
  function readURL(){
    const u = new URL(location.href);
    const s = u.searchParams.get('s');
    if(!s) return null;
    try{ return JSON.parse(decodeURIComponent(escape(atob(s)))); }catch{ return null; }
  }
  function saveState(){ localStorage.setItem('erettsegi_calc_state_v3', JSON.stringify(currentState())); }
  function loadState(){
    try{
      const s = JSON.parse(localStorage.getItem('erettsegi_calc_state_v3'));
      if(s) applyState(s);
      else{
        // migrate v1/v2 if present
        const s2 = JSON.parse(localStorage.getItem('erettsegi_calc_state_v2')); if(s2) applyState(s2);
        const s1 = JSON.parse(localStorage.getItem('erettsegi_calc_state')); if(s1) applyState(s1);
      }
    }catch{}
    const fromURL = readURL(); if(fromURL) applyState(fromURL);
  }

  // Share buttons
  function copyLink(){ syncURL(); navigator.clipboard.writeText(location.href).then(()=>{ alert('Link v√°g√≥lapra m√°solva'); }); }
  $('#shareBtn')?.addEventListener('click', copyLink);
  $('#shareBtn2')?.addEventListener('click', copyLink);
  $('#shareBtn3')?.addEventListener('click', copyLink);

  $('#resetBtn')?.addEventListener('click', ()=>{ localStorage.removeItem('erettsegi_calc_state_v3'); location.href = location.pathname; });
  $('#saveBtn')?.addEventListener('click', saveState);

  // Init
  loadState();
  calc();
})();
</script>
</body>
</html>
